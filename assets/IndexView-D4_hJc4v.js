import{aD as e,aV as t,d as s,k as a,a as r,a2 as l,D as i,u as o,p as n,q as u,A as c,B as d,R as p,g as m,E as f,y as _,S as k,aW as y,e as v}from"./index-HMHCBO22.js";import{_ as h}from"./Content.vue_vue_type_script_setup_true_lang-BU2yl4QK.js";import{a as g,K as w,r as T,L as C,_ as x,N as j,g as b,S as $}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";import{_ as W}from"./DataTable.vue_vue_type_script_setup_true_lang-7wIpl8ID.js";import{P}from"./PlusOutlined-BsZVx2JX.js";import{u as L}from"./composables-sjxCGT15.js";import"./Checkbox-dOjwP0iZ.js";import"./Ellipsis-CsA7j8A2.js";const U=e("ticket",(()=>({closeTicket:async function(e,s,a,r,l={}){return new Promise((i=>{const o=a.warning({title:r("Close Ticket"),content:r("Once closed, you cannot reply to the ticket. Are you sure you want to close this ticket?"),positiveText:r("Confirm"),negativeText:r("Cancel"),onPositiveClick:()=>(o.loading=!0,new Promise((a=>{t({path:{issue_no:e}}).then((()=>{s.success(r("Closed successfully")),a(!0)})).finally((()=>{o.loading=!1,i(!0)}))}))),...l})}))}}))),D={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},E={class:"grow md:grow-0 md:basis-1/2"},K=s({__name:"IndexView",setup(e){const t=U(),s=o(),{t:K}=a(),S=g(),q=L(),z=r(),A=[{title:K("Ticket Number"),key:"issue_no",minWidth:250},{title:K("Ticket Title"),key:"title",minWidth:300},{title:K("Ticket Level"),key:"level",minWidth:120,sorter:!0,align:"center",render(e){const t={low:K("Low"),medium:K("Medium"),high:K("High")},s=e.level;return l(w,{type:{low:"info",medium:"warning",high:"danger"}[s]},{default:()=>t[s]||K("Unknown")})}},{title:K("Ticket Status"),key:"status",minWidth:100,sorter:!0,align:"center",render(e){const t={in_progress:K("Processing"),completed:K("Completed")},s=e.status;return l(w,{type:{in_progress:"warning",completed:"success"}[s]},{default:()=>t[s]??K("Unknown")})}},{title:K("Creation Time"),minWidth:200,key:"created_at",sorter:!0,align:"center",render:e=>T(e.created_at).format("L")},{title:K("Actions"),key:"actions",minWidth:170,fixed:"right",align:"center",render:e=>l(C,{vertical:!1,size:5,justify:"center"},{default:()=>[l(i,{size:"small",onClick:()=>{s.push(`/user/tickets/${e.issue_no}`)}},{default:()=>K("Details")}),l(i,{disabled:"completed"===e.status,size:"small",type:"error",onClick:()=>{t.closeTicket(e.issue_no,S,q,K).finally((()=>{var e;M.value=[],null==(e=z.value)||e.refresh()}))}},{default:()=>K("Close Ticket")})]})}],N=r(""),R=r("sort:latest"),M=r([]),O=e=>y({query:{page:e,per_page:40,q:`${N.value} ${R.value}`.trim()}});function V(e){var t;e.order?R.value=`sort:${e.columnKey}:${e.order}`:R.value="sort:latest",null==(t=z.value)||t.refresh()}function B(){var e;null==(e=z.value)||e.refresh()}return(e,t)=>(v(),n(x,{"header-title":e.$t("My Tickets"),"toggle-header":!1,"show-footer":!1},{default:u((()=>[c(h,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:u((()=>[c(d(p),null,{default:u((()=>[c(d(C),{vertical:""},{default:u((()=>[m("div",D,[m("div",null,[c(d(i),{tertiary:"",onClick:t[0]||(t[0]=()=>{d(s).push("/user/tickets/create")})},{icon:u((()=>[c(d(j),{component:d(P)},null,8,["component"])])),default:u((()=>[f(" "+_(e.$t("Create Ticket")),1)])),_:1})]),m("div",E,[c(d(b),{value:N.value,"onUpdate:value":t[1]||(t[1]=e=>N.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:k(B,["enter","native"])},{prefix:u((()=>[c(d(j),{component:d($)},null,8,["component"])])),_:1},8,["value","placeholder"])])]),c(W,{striped:"",ref_key:"tableRef",ref:z,bordered:!1,fetch:O,columns:A,"row-key":e=>e.id,"checked-row-keys":M.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>M.value=e),onUpdateSorter:V},null,8,["row-key","checked-row-keys"])])),_:1})])),_:1})])),_:1})])),_:1},8,["header-title"]))}});export{K as default};
