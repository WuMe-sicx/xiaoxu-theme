import{d as e,h as a,i as l,j as t,a as r,L as o,c as n,o as s,u,T as i,p as d,q as p,e as c,b as v,A as m,B as g,C as y,E as f,y as _,U as h,g as b,D as k,F as w,G as $,V as x,W as j}from"./index-HMHCBO22.js";import{_ as q}from"./AuthFormCard.vue_vue_type_script_setup_true_lang-C8srH85Z.js";import{a as L,_ as C,h as S,i as U,j as z,k as P,g as A,f as N,l as M,N as O,d as R,m as B}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";import{N as E}from"./Alert-Dp99rEM1.js";import{L as F}from"./LogInOutline-C93VvCZI.js";import{N as I}from"./Checkbox-dOjwP0iZ.js";import{N as V}from"./Spin-DJBzsfd9.js";import"./bg-BidHQfEv.js";const D={key:0,class:"h-full flex justify-center items-center"},T={class:"flex justify-between"},W={key:3,class:"mt-8 mb-4"},G={class:"flex flex-row justify-center relative"},H={class:"relative z-[2] text-sm px-4 bg-white dark:bg-[var(--n-color)] text-gray-500"},Q={class:"flex justify-center space-x-6 mt-4"},J={class:"flex justify-between mt-6"},K=e({__name:"LoginView",setup(e){var K,X;const Y=a(),Z=l(),ee=t(),ae=Z.getSelectOptionCountryCodes(),le=e=>{var a,l;return(null==(l=null==(a=e.option.label)?void 0:a.toString())?void 0:l.match(/^\+\d+/))||""},te=r(!0),re=o(),oe=u(),ne=L(),se=r(null),ue=r({login_type:"email",username:"",password:"",remember:!0,token:(null==(X=null==(K=re.query)?void 0:K.token)?void 0:X.toString())||"",country_code:"cn"}),ie=n((()=>{var e;return(null==(e=Z.configs)?void 0:e.site.user_login_types)||[]})),de=async()=>{var e,a;const l=await x({body:ue.value});if("error"===(null==(e=l.data)?void 0:e.status))return ne.error(null==(a=l.data)?void 0:a.message);await pe(l.data.data.token)},pe=async e=>{ee.setToken(e),window.location.href="/user/dashboard"};return s((()=>{ie.value.length>0&&(ue.value.login_type=ie.value[0]),ee.isLoggedIn&&oe.push("/user/dashboard").then((()=>{Y.setSidebarOpen(!0)})),re.query.driver_id&&re.query.code?i({path:{id:re.query.driver_id.toString()},body:{code:re.query.code.toString()}}).then((e=>{var a;const l=(null==(a=e.data)?void 0:a.data.token.toString())||"";202===e.status?(oe.replace({query:{token:l}}),ue.value.token=l):pe(l)})).finally((()=>{te.value=!1})):te.value=!1})),(e,a)=>(c(),d(C,{"header-title":e.$t("Login")},{default:p((()=>{var l;return[te.value?(c(),v("div",D,[m(g(V),{size:"small",description:"loading..."})])):(c(),d(q,{key:1,title:e.$t("Login to {sitename}",{sitename:null==(l=g(Z).configs)?void 0:l.site.title})},{default:p((()=>[ue.value.token?(c(),d(g(E),{key:0,type:"info",class:"mb-4"},{default:p((()=>[f(_(e.$t("Please log in to your account. After binding, you can log in directly next time.")),1)])),_:1})):y("",!0),ie.value.length>1?(c(),d(g(S),{key:1,type:"segment",class:"mb-4",value:ue.value.login_type,"onUpdate:value":a[0]||(a[0]=e=>ue.value.login_type=e)},{default:p((()=>[ie.value.includes("email")?(c(),d(g(U),{key:0,name:"email",tab:e.$t("Login with Email")},null,8,["tab"])):y("",!0),ie.value.includes("phone")?(c(),d(g(U),{key:1,name:"phone",tab:e.$t("Login with Mobile Number")},null,8,["tab"])):y("",!0),ie.value.includes("username")?(c(),d(g(U),{key:2,name:"username",tab:e.$t("Login with Username")},null,8,["tab"])):y("",!0)])),_:1},8,["value"])):y("",!0),m(g(z),{ref_key:"formRef",ref:se,model:ue.value,"show-require-mark":!0,onSubmit:h(de,["prevent"])},{default:p((()=>{var l,t,r,o,n;return["email"===ue.value.login_type?(c(),d(g(P),{key:0,label:e.$t("Email")},{default:p((()=>[m(g(A),{value:ue.value.username,"onUpdate:value":a[1]||(a[1]=e=>ue.value.username=e),"input-props":{type:"email",required:!0},placeholder:e.$t("Please enter your email"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"])):y("",!0),"phone"===ue.value.login_type?(c(),d(g(P),{key:1,label:e.$t("Mobile Number")},{default:p((()=>[m(g(N),null,{default:p((()=>[m(g(M),{options:g(ae),"render-tag":le,"consistent-menu-width":!1,value:ue.value.country_code,"onUpdate:value":a[2]||(a[2]=e=>ue.value.country_code=e),class:"w-28",size:"large",filterable:"",placeholder:e.$t("Select Country")},null,8,["options","value","placeholder"]),m(g(A),{value:ue.value.username,"onUpdate:value":a[3]||(a[3]=e=>ue.value.username=e),placeholder:e.$t("Please enter your mobile number"),"input-props":{required:!0},size:"large"},null,8,["value","placeholder"])])),_:1})])),_:1},8,["label"])):y("",!0),"username"===ue.value.login_type?(c(),d(g(P),{key:2,label:e.$t("Username")},{default:p((()=>[m(g(A),{value:ue.value.username,"onUpdate:value":a[4]||(a[4]=e=>ue.value.username=e),"input-props":{required:!0},placeholder:e.$t("Please enter your username"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"])):y("",!0),m(g(P),{label:e.$t("Password"),"show-feedback":!1},{default:p((()=>[m(g(A),{value:ue.value.password,"onUpdate:value":a[5]||(a[5]=e=>ue.value.password=e),placeholder:e.$t("Please enter your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),m(g(P),null,{default:p((()=>[m(g(k),{type:"primary","attr-type":"submit",size:"large",strong:"",block:""},{icon:p((()=>[m(g(O),{component:g(F)},null,8,["component"])])),default:p((()=>[f(" "+_(e.$t("Login")),1)])),_:1})])),_:1}),b("div",T,[m(g(I),{"default-checked":ue.value.remember,"checked-value":ue.value.remember,"onUpdate:checkedValue":a[6]||(a[6]=e=>ue.value.remember=e)},{default:p((()=>[f(_(e.$t("Remember Me")),1)])),_:1},8,["default-checked","checked-value"]),m(g(k),{text:"",type:"info",onClick:a[7]||(a[7]=e=>g(oe).push("/forget-password"))},{default:p((()=>[f(_(e.$t("Forgot Password?")),1)])),_:1})]),!ue.value.token&&((null==(l=g(Z).configs)?void 0:l.app.socialites)||[]).length>0?(c(),v("div",W,[b("div",G,[a[10]||(a[10]=b("div",{class:"absolute top-[10px] h-[1px] bg-gray-200 dark:bg-gray-500 w-[80%] z-[1]"},null,-1)),b("p",H,_(e.$t("Login with Other Methods")),1)]),b("div",Q,[(c(!0),v(w,null,$((null==(t=g(Z).configs)?void 0:t.app.socialites)||[],(e=>(c(),d(g(k),{text:"",onClick:a=>(async e=>{var a,l;const t=await j({path:{id:e.id.toString()},query:{redirect_url:`${R.getWithoutQueryUrl()}?driver_id=${e.id}`}});if("error"===(null==(a=t.data)?void 0:a.status))return ne.error(null==(l=t.data)?void 0:l.message);window.location.replace(t.data.data.redirect_url)})(e)},{icon:p((()=>[m(g(O),{component:g(R).getSocialiteIcon(e.provider)},null,8,["component"])])),default:p((()=>[f(" "+_(e.name),1)])),_:2},1032,["onClick"])))),256))])])):y("",!0),b("div",J,[m(g(k),{text:"",type:"info",onClick:a[8]||(a[8]=e=>g(oe).push("/"))},{default:p((()=>[f(_(e.$t("Back to Home")),1)])),_:1}),m(g(B),{trigger:"hover",disabled:(null==(r=g(Z).configs)?void 0:r.app.enable_registration)&&((null==(o=g(Z).configs)?void 0:o.app.user_email_verify)||(null==(n=g(Z).configs)?void 0:n.app.user_phone_verify))},{trigger:p((()=>{var l,t,r;return[b("p",null,[b("span",null,_(e.$t("Don't have an account?")),1),m(g(k),{text:"",type:"info",onClick:a[9]||(a[9]=e=>g(oe).push({path:"/register",query:{token:ue.value.token||void 0}})),disabled:!(null==(l=g(Z).configs)?void 0:l.app.enable_registration)||!(null==(t=g(Z).configs)?void 0:t.app.user_email_verify)&&!(null==(r=g(Z).configs)?void 0:r.app.user_phone_verify)},{default:p((()=>[f(_(e.$t("Register Account")),1)])),_:1},8,["disabled"])])]})),default:p((()=>[f(" "+_(e.$t("Registration is currently closed")),1)])),_:1},8,["disabled"])])]})),_:1},8,["model"])])),_:1},8,["title"]))]})),_:1},8,["header-title"]))}});export{K as default};
