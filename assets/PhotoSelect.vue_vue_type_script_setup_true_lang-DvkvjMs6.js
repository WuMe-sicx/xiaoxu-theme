import{w as e,a as t,z as l,N as a,H as o,I as s,r as i,v as n,j as c,G as r,k as u,g as d,J as p}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";import{d as v,b as m,e as h,g as f,j as y,c as g,k as b,L as k,a as _,F as x,A as w,B as C,an as S,U as A,x as P,p as M,C as z,ai as j,q as E,a2 as I,av as D,n as U,M as L,_ as T,v as $,y as B,G as N,D as O,E as K,o as R,az as W,ar as F,aA as G}from"./index-HMHCBO22.js";import{P as H,W as q}from"./WaterfallLayout-Bhg1tzW2.js";import{E as J}from"./album-DI7nO5SG.js";import{S as V}from"./ShareOutline-EQRXYPYI.js";import{D as X}from"./DeleteOutlined-D1D-Si2V.js";import{u as Y}from"./composables-sjxCGT15.js";import{N as Q}from"./Spin-DJBzsfd9.js";import{N as Z}from"./Popconfirm-D7351gxE.js";const ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},te=[f("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M336 64h112v112"},null,-1),f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M224 288L440 72"},null,-1)],le=v({name:"OpenOutline",render:function(e,t){return h(),m("svg",ee,te)}}),ae={class:"relative group bg-gray-200 dark:bg-gray-700"},oe={class:"absolute inset-0 flex justify-between z-[2] select-none"},se={class:"absolute top-2 right-2"},ie={class:"flex gap-2"},ne=["onClick"],ce=["onClick"],re=T(v({__name:"Photo",props:{photo:{}},emits:["onToggleSelect"],setup(i,{emit:n}){const c=i;y();const r=g((()=>c.photo)),u=e(),{t:d}=b(),p=t(),v=Y(),T=k(),$=g((()=>T.path.includes("/user/albums/"))),B=_(null),N=_(!1),O=_(),K={showThumbnails:!0,showDrawer:!0,drawerConfig:{defaultOpen:!0,title:"图片信息"},controls:{showClose:!0,showInfo:!0,showNavigation:!0}},R=g((()=>u.groups.flatMap((e=>e.photos)).map((e=>({id:e.key,src:e.public_url||e.src,thumbnail:e.thumbnail_url||e.src,name:e.name,width:e.width,height:e.height,size:e.size,extension:e.extension,created_at:e.created_at||void 0,is_public:e.is_public,tags:e.tags||[]})))));function W(e){e&&(e.preventDefault(),e.stopPropagation());const t=r.value.key;if(e&&(e.ctrlKey||e.metaKey))return u.toggleSelect(t),void(B.value=t);e&&e.shiftKey&&B.value?function(e,t){let l=-1,a=-1,o=-1,s=-1;const i=u.groups;for(let n=0;n<i.length;n++){const c=i[n];for(let i=0;i<c.photos.length;i++)c.photos[i].key===e&&(l=n,a=i),c.photos[i].key===t&&(o=n,s=i)}if(-1===l||-1===o)return;(l>o||l===o&&a>s)&&([l,o]=[o,l],[a,s]=[s,a]);for(let n=l;n<=o;n++){const e=i[n],t=n===l?a:0,c=n===o?s:e.photos.length-1;for(let l=t;l<=c;l++){const t=e.photos[l].key;e.photos[l].selected||u.toggleSelect(t)}}}(B.value,t):(u.toggleSelect(t),B.value=t)}function F(e){e.ctrlKey||e.metaKey||e.shiftKey?W(e):(e.preventDefault(),O.value=r.value.key,N.value=!0)}function G(e){return()=>I(a,null,{default:()=>I(e)})}const q=g((()=>[{label:d("Copy Image"),key:"copy",disabled:u.selections.length>1,icon:G(o)},{label:d("Copy Link"),key:"copy-urls",icon:G(o),children:[{label:"Url",key:"copy-url"},{label:"Html",key:"copy-html"},{label:"BBCode",key:"copy-bbcode"},{label:"Markdown",key:"copy-markdown"},{label:"Markdown with link",key:"copy-markdown_with_link"},{label:"Thumbnail url",key:"copy-thumbnail_url"}]},{label:d("Open in New Window"),key:"open",disabled:u.selections.length>1,icon:G(le)},{label:d("Edit Information"),key:"edit",icon:G(J)},{label:d("Share"),key:"share",icon:G(V)},...$.value?[{label:d("Remove from Album"),key:"remove-from-album",icon:G(s)}]:[{label:d("Add to Album"),key:"to-album",icon:G(s)}],{type:"divider",key:"d1"},{label:d("Delete"),key:"delete",icon:G(X)}])),Q=_(!1),Z=_(0),ee=_(0);function te(e){var t;Q.value=!1;const l=String(e);switch(l){case"copy":u.copyImage(r.value.src).then((()=>{p.success(d("Copy successful"))})).catch((e=>{p.error(d("Copy failed"))}));break;case"copy-url":case"copy-html":case"copy-bbcode":case"copy-markdown":case"copy-markdown_with_link":case"copy-thumbnail_url":u.copyLink(l.replace("copy-","")).then((()=>{p.success(d("Copy successful"))})).catch((()=>{p.error(d("Copy failed"))}));break;case"open":u.openPhoto(r.value);break;case"edit":u.setEditModalActive(!0);break;case"share":u.setShareModalActive(!0);break;case"to-album":null==(t=u.albumSelectorRef)||t.open();break;case"remove-from-album":const e=Number(T.params.id);if(e){const t=v.warning({title:d("Warning"),content:d("Are you sure you want to remove the selected {count} photos from the album?",{count:u.selections.length}),positiveText:d("Confirm"),negativeText:d("Cancel"),onPositiveClick:()=>(t.loading=!0,D({path:{id:e},body:u.selections.map((e=>e.id))}).then((()=>{p.success(d("Removed successfully")),u.deletePhotos(u.selections.map((e=>e.key)));const e=y();e.isLoggedIn&&e.fetchUserProfile()})))})}break;case"delete":const a=v.warning({title:d("Warning"),content:d("Are you sure you want to delete the selected {count} photos?",{count:u.selections.length}),positiveText:d("Confirm"),negativeText:d("Cancel"),onPositiveClick:()=>(a.loading=!0,u.deleteSelectedPhotos().then((()=>{p.success(d("Deleted successfully"))})))})}}function re(e){e.preventDefault(),Q.value=!1,U().then((()=>{Q.value=!0,Z.value=e.clientX,ee.value=e.clientY})),r.value.selected||(u.unselectAll(),setTimeout((()=>{u.toggleSelect(r.value.key)}),10))}function ue(){Q.value=!1}return(e,t)=>(h(),m(x,null,[f("a",{href:"javascript:void(0)",onContextmenu:re,onClick:F},[w(C(l),{placement:"bottom-start",trigger:"manual",x:Z.value,y:ee.value,options:q.value,show:Q.value,"on-clickoutside":ue,onSelect:te},null,8,["x","y","options","show"]),f("div",ae,[t[3]||(t[3]=f("div",{class:"transition-all absolute w-full top-0 h-1/2 bg-gradient-to-b from-black/30 opacity-0 group-hover:opacity-100"},null,-1)),f("div",oe,[w(C(S),{class:P(["rounded-full cursor-pointer absolute top-2 left-2",r.value.selected?"text-violet-500 bg-white outline outline-1 outline-white dark:outline-gray-500":"hidden group-hover:block text-white/70 hover:text-white"]),icon:"fa-solid fa-circle-check",size:"xl",onClick:A(W,["prevent","stop"])},null,8,["class"]),f("div",se,[r.value.is_public?(h(),M(C(S),{key:0,class:"text-red-500",icon:"fa-solid fa-eye",title:e.$t("Public")},null,8,["title"])):z("",!0)])]),f("div",{class:P(["overflow-hidden transition-all",r.value.selected?"scale-90 rounded-lg":""])},[j(e.$slots,"default",{},void 0,!0)],2)])],32),w(C(H),{show:N.value,"onUpdate:show":t[0]||(t[0]=e=>N.value=e),"current-photo-id":O.value,"onUpdate:currentPhotoId":t[1]||(t[1]=e=>O.value=e),photos:R.value,config:K,"onPhoto:change":t[2]||(t[2]=e=>{})},{"top-right":E((({photo:e})=>[f("div",ie,[f("button",{class:"viewer-button",onClick:t=>function(e){const t=u.groups.flatMap((e=>e.photos)).find((t=>t.key===e.id));if(t){const e=u.selections.slice();u.unselectAll(),u.toggleSelect(t.key),u.setEditModalActive(!0);const l=L((()=>u.editModalActive),(t=>{t||(u.unselectAll(),e.forEach((e=>{u.toggleSelect(e.key)})),l())}))}}(e)},[w(C(S),{icon:"fa-solid fa-edit",class:"text-sm text-white"})],8,ne),f("button",{class:"viewer-button",onClick:t=>function(e){const t=u.groups.flatMap((e=>e.photos)).find((t=>t.key===e.id));if(t){const e=u.selections.slice();u.unselectAll(),u.toggleSelect(t.key),u.setShareModalActive(!0);const l=L((()=>u.shareModalActive),(t=>{t||(u.unselectAll(),e.forEach((e=>{u.toggleSelect(e.key)})),l())}))}}(e)},[w(C(S),{icon:"fa-solid fa-share",class:"text-sm text-white"})],8,ce)])])),"drawer-content":E((({photo:e})=>t[4]||(t[4]=[]))),_:1},8,["show","current-photo-id","photos"])],64))}}),[["__scopeId","data-v-70120bdd"]]),ue={class:"photo-image-container relative w-full"},de={key:0,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},pe={key:1,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},ve=["src","alt"],me=T(v({__name:"PhotoImage",props:{src:{type:String,required:!0},alt:{type:String,default:""},placeholderText:{type:String,default:"努力加载中..."},aspectRatio:{type:String,default:"auto"}},setup(e){const t=_(!0),l=_(!1),a=_();function o(){t.value=!1,l.value=!1}function s(){t.value=!1,l.value=!0}return(i,n)=>(h(),m("div",ue,[t.value||l.value?(h(),m("div",{key:0,class:"absolute inset-0 bg-gray-100 dark:bg-gray-700 rounded-sm flex items-center justify-center",style:$({minHeight:"200px"})},[t.value?(h(),m("div",de,B(e.placeholderText),1)):l.value?(h(),m("div",pe," 加载失败 ")):z("",!0)],4)):z("",!0),f("img",{ref_key:"imageRef",ref:a,src:e.src,alt:e.alt,class:P(["w-full h-auto object-cover rounded-sm transition-opacity duration-300",{"opacity-0":t.value||l.value,"opacity-100":!t.value&&!l.value}]),loading:"lazy",onLoad:o,onError:s},null,42,ve)]))}}),[["__scopeId","data-v-04ab47bf"]]),he={class:"flex flex-col space-y-2"},fe={class:"sticky top-12 z-[3] py-2 bg-white dark:bg-[var(--n-color)] flex space-x-2 items-center overflow-hidden group text-md"},ye={class:"font-bold"},ge=v({__name:"PhotoGroup",props:{group:{type:Object,default:()=>{},required:!0}},setup(t){const l=t,{toggleSelectAllByGroup:a}=e(),{t:o}=b(),s=[o("Sunday"),o("Monday"),o("Tuesday"),o("Wednesday"),o("Thursday"),o("Friday"),o("Saturday")],n=g((()=>l.group.photos.map((e=>({...e,id:e.key})))));return(e,t)=>(h(),m("div",he,[f("div",fe,[w(C(S),{icon:l.group.selected?"fa-solid fa-circle-check":"fa-regular fa-circle",size:"xl",class:P(["cursor-pointer transition-all select-none",l.group.selected?"text-violet-500 ml-0.5":"-ml-6 group-hover:ml-0.5 text-gray-500/70"]),onClick:t[0]||(t[0]=()=>C(a)(l.group.date))},null,8,["icon","class"]),f("p",ye,B(C(i)(l.group.date).format("L"))+" "+B(s[C(i)(l.group.date).day()]),1)]),w(q,{items:n.value,"column-width":220,gap:8},{default:E((({item:e})=>[w(re,{photo:e},{default:E((()=>[w(me,{src:e.src,alt:e.name||"","placeholder-text":"拼命加载中..."},null,8,["src","alt"])])),_:2},1032,["photo"])])),_:1},8,["items"])]))}}),be={key:2,class:"flex justify-center py-10"},ke=v({__name:"PhotoList",setup(t){const l=e();return(e,t)=>(h(),m(x,null,[C(l).isLoading||0!==C(l).groups.length?(h(!0),m(x,{key:1},N(C(l).groups,(e=>(h(),M(ge,{group:e,key:e.date},null,8,["group"])))),128)):(h(),M(C(n),{key:0,class:"my-10",description:e.$t("No photos available")},null,8,["description"])),C(l).isLoading?(h(),m("div",be,[w(C(Q),{size:25})])):z("",!0)],64))}}),_e=v({__name:"PhotoOperates",setup(t){const l=e();return(e,t)=>(h(),m("div",{class:P(["flex flex-col items-center absolute p-2 md:p-3 my-2 z-[3] bg-white/95 dark:bg-black/80 border border-transparent dark:border-slate-400 transition-all rounded-2xl shadow-md space-y-2 md:space-y-3",C(l).selections.length>0?"right-2 md:right-6":"-right-20"])},[j(e.$slots,"default")],2))}}),xe=v({__name:"PhotoCopyLink",setup(a){const o=e(),s=t(),{t:i}=b(),n=[{label:"Url",key:"url"},{label:"Html",key:"html"},{label:"BBCode",key:"bbcode"},{label:"Markdown",key:"markdown"},{label:"Markdown with link",key:"markdown_with_link"},{label:"Thumbnail url",key:"thumbnail_url"}];function c(e){0!==o.selections.length?o.copyLink(e).then((()=>{s.success(i("Copy successful"))})).catch((()=>{s.error(i("Copy failed"))})):s.warning(i("Please select photos first"))}return(e,t)=>(h(),M(C(l),{placement:"left-start",trigger:"hover",size:"small","show-arrow":"",options:n,onSelect:c},{default:E((()=>[w(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Copy Link")},{icon:E((()=>[w(C(S),{icon:"fa-solid fa-copy"})])),_:1},8,["title"])])),_:1}))}}),we=v({__name:"PhotoCancel",setup(t){const l=e();return(e,t)=>(h(),M(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Deselect")},{icon:E((()=>[w(C(S),{icon:"fa-solid fa-times",onClick:t[0]||(t[0]=e=>C(l).unselectAll())})])),_:1},8,["title"]))}}),Ce=v({__name:"PhotoDelete",setup(l){const a=e(),o=t(),{t:s}=b();function i(){a.deleteSelectedPhotos().then((()=>{o.success(s("Deleted successfully"))}))}return(e,t)=>(h(),M(C(Z),{placement:"left-start",onPositiveClick:i},{trigger:E((()=>[w(C(O),{quaternary:"",circle:"",size:"small",type:"error",title:e.$t("Delete Selected Items")},{icon:E((()=>[w(C(S),{icon:"fa-solid fa-trash-alt"})])),_:1},8,["title"])])),default:E((()=>[K(" "+B(e.$t("Are you sure you want to delete the selected {count} photos?",{count:C(a).selections.length})),1)])),_:1}))}}),Se={key:0,class:"flex flex-col space-y-4"},Ae={key:0,class:"text-sm dark:text-gray-300 mb-2 text-center p-2 bg-gray-50 dark:bg-gray-800 rounded"},Pe={key:1,class:"mb-4 bg-gray-50 dark:bg-gray-800 p-3 rounded"},Me={class:"text-sm font-medium mb-2 text-gray-700 dark:text-gray-300"},ze={class:"flex flex-wrap gap-4"},je={class:"flex items-center gap-2"},Ee={class:"text-sm"},Ie={class:"flex items-center gap-2"},De={class:"text-sm"},Ue={class:"flex items-center gap-2"},Le={class:"text-sm"},Te={class:"flex items-center gap-2"},$e={class:"text-sm"},Be={class:"flex justify-end space-x-2"},Ne=v({__name:"PhotoEdit",setup(l){const a=e(),o=g((()=>a.selections)),s=g((()=>o.value.length>1)),i=g((()=>a.selections[0]||{tags:[]})),n=_(),v=_({}),y={},k=t(),{t:A}=b(),P=_({name:!s.value,intro:!s.value,is_public:!s.value,tags:!s.value});function j(){var e;if(0===o.value.length)return;const{name:t,intro:l,is_public:a}=i.value,n=(null==(e=i.value.tags)?void 0:e.map((e=>e.name)))||[];v.value={name:t,intro:l,is_public:a,tags:n},P.value={name:!s.value,intro:!s.value,is_public:!s.value,tags:!s.value}}async function I(){const e={ids:o.value.map((e=>e.id))};P.value.name&&(e.name=v.value.name),P.value.intro&&(e.intro=v.value.intro),P.value.is_public&&(e.is_public=v.value.is_public),P.value.tags&&(e.tags=v.value.tags),await G({body:e}).then((()=>{k.success(A("Successfully updated")),a.setEditModalActive(!1),o.value.forEach((e=>{P.value.name&&(e.name=v.value.name),P.value.intro&&(e.intro=v.value.intro),P.value.is_public&&(e.is_public=v.value.is_public),P.value.tags&&(e.tags=v.value.tags.map((e=>({name:e}))))}))})).catch((e=>{k.error(A("Update failed"))}))}return R((()=>{j()})),L((()=>a.editModalActive),(e=>{e&&U((()=>{j()}))})),(e,t)=>(h(),m(x,null,[(h(),M(W,{to:"body"},[w(C(F),{show:C(a).editModalActive,"onUpdate:show":t[9]||(t[9]=e=>C(a).editModalActive=e),title:s.value?C(A)("Batch Edit Information"):C(A)("Edit Information"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto","mask-closable":!1},{action:E((()=>[f("div",Be,[w(C(O),{tertiary:"",type:"default",onClick:t[8]||(t[8]=e=>C(a).setEditModalActive(!1))},{default:E((()=>[K(B(C(A)("Cancel")),1)])),_:1}),w(C(O),{tertiary:"",type:"primary",onClick:I},{default:E((()=>[K(B(C(A)("Save")),1)])),_:1})])])),default:E((()=>[o.value.length>0?(h(),m("div",Se,[w(C(c),{ref_key:"formRef",ref:n,model:v.value,rules:y},{default:E((()=>[s.value?(h(),m("div",Ae,B(C(A)("Selected {count} photos for batch editing",{count:o.value.length})),1)):z("",!0),s.value?(h(),m("div",Pe,[f("div",Me,B(C(A)("Select fields to update"))+":",1),f("div",ze,[f("div",je,[w(C(r),{value:P.value.name,"onUpdate:value":t[0]||(t[0]=e=>P.value.name=e),size:"small"},null,8,["value"]),f("span",Ee,B(C(A)("Custom Name")),1)]),f("div",Ie,[w(C(r),{value:P.value.intro,"onUpdate:value":t[1]||(t[1]=e=>P.value.intro=e),size:"small"},null,8,["value"]),f("span",De,B(C(A)("Description")),1)]),f("div",Ue,[w(C(r),{value:P.value.tags,"onUpdate:value":t[2]||(t[2]=e=>P.value.tags=e),size:"small"},null,8,["value"]),f("span",Le,B(C(A)("Tags")),1)]),f("div",Te,[w(C(r),{value:P.value.is_public,"onUpdate:value":t[3]||(t[3]=e=>P.value.is_public=e),size:"small"},null,8,["value"]),f("span",$e,B(C(A)("Is Public")),1)])])])):z("",!0),w(C(u),{label:C(A)("Custom Name"),path:"name"},{default:E((()=>[w(C(d),{value:v.value.name,"onUpdate:value":t[4]||(t[4]=e=>v.value.name=e),disabled:s.value&&!P.value.name,placeholder:s.value&&!P.value.name?C(A)("Field not selected"):""},null,8,["value","disabled","placeholder"])])),_:1},8,["label"]),w(C(u),{label:C(A)("Description"),path:"intro"},{default:E((()=>[w(C(d),{resizable:"",type:"textarea",value:v.value.intro,"onUpdate:value":t[5]||(t[5]=e=>v.value.intro=e),disabled:s.value&&!P.value.intro,placeholder:s.value&&!P.value.intro?C(A)("Field not selected"):""},null,8,["value","disabled","placeholder"])])),_:1},8,["label"]),w(C(u),{label:C(A)("Tags"),path:"tags"},{default:E((()=>[w(C(p),{value:v.value.tags,"onUpdate:value":t[6]||(t[6]=e=>v.value.tags=e),disabled:s.value&&!P.value.tags,placeholder:s.value&&!P.value.tags?C(A)("Field not selected"):""},null,8,["value","disabled","placeholder"])])),_:1},8,["label"]),w(C(u),{label:C(A)("Is Public"),path:"is_public"},{default:E((()=>[w(C(r),{value:v.value.is_public,"onUpdate:value":t[7]||(t[7]=e=>v.value.is_public=e),disabled:s.value&&!P.value.is_public},null,8,["value","disabled"])])),_:1},8,["label"])])),_:1},8,["model"])])):z("",!0)])),_:1},8,["show","title"])])),w(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:o.value.length>1?C(A)("Batch Edit Information"):C(A)("Edit Information"),onClick:t[10]||(t[10]=e=>C(a).setEditModalActive(!0))},{icon:E((()=>[w(C(S),{icon:"fa-solid fa-edit"})])),_:1},8,["title"])],64))}}),Oe=v({__name:"PhotoSelect",setup(t){const l=e();return(e,t)=>(h(),M(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:C(l).isAllSelected?e.$t("Deselect All"):e.$t("Select All")},{icon:E((()=>[w(C(S),{icon:"fa-solid fa-"+(C(l).isAllSelected?"check-double":"check"),onClick:t[0]||(t[0]=()=>{C(l).isAllSelected?C(l).unselectAll():C(l).selectAll()})},null,8,["icon"])])),_:1},8,["title"]))}});export{me as P,ke as _,_e as a,we as b,Oe as c,xe as d,Ne as e,Ce as f};
