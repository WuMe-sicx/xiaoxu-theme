import{d as e,h as a,i as t,j as l,a as r,k as o,L as s,o as i,u as n,T as u,p as d,q as p,b as c,A as v,B as m,C as f,E as g,y,U as _,g as h,D as b,F as w,G as k,e as $,X as q,W as x}from"./index-HMHCBO22.js";import{_ as j}from"./AuthFormCard.vue_vue_type_script_setup_true_lang-C8srH85Z.js";import{a as U,_ as z,h as R,i as S,j as P,g as A,k as C,N as L,d as N}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";import{_ as I,a as O}from"./PhoneVerifyInput.vue_vue_type_script_setup_true_lang-Dt4Uw5wo.js";import{L as T}from"./LogInOutline-C93VvCZI.js";import{N as B}from"./Spin-DJBzsfd9.js";import{N as D}from"./Alert-Dp99rEM1.js";import"./bg-BidHQfEv.js";const E={key:0,class:"w-full h-full flex items-center justify-center"},F={class:"flex justify-between"},G={key:2,class:"mt-8 mb-4"},M={class:"flex flex-row justify-center relative"},V={class:"relative z-[2] text-sm px-4 bg-white dark:bg-[var(--n-color)] text-gray-500"},W={class:"flex justify-center space-x-6 mt-4"},Q={key:3,class:"text-center"},X=e({__name:"RegisterView",setup(e){var X,H;const J=a(),K=t(),Y=l(),Z=r(!0),ee=s(),ae=n(),te=U(),{t:le}=o(),re=r(null),oe=r({email:"",phone:"",name:"",username:"",password:"",password_confirmation:"",code:"",country_code:"cn",token:(null==(H=null==(X=ee.query)?void 0:X.token)?void 0:H.toString())||""}),se=async()=>{var e,a;const t=await q({body:oe.value});if("error"===(null==(e=t.data)?void 0:e.status))return te.error(null==(a=t.data)?void 0:a.message);te.success(le("Registration successful. Please log in.")),await ae.push("/login")},ie=r("email");return i((()=>{var e;ie.value=(null==(e=K.configs)?void 0:e.app.user_email_verify)?"email":"phone",Y.isLoggedIn&&ae.push("/user/dashboard").then((()=>{J.setSidebarOpen(!0)})),ee.query.driver_id&&ee.query.code?u({path:{id:ee.query.driver_id.toString()},body:{code:ee.query.code.toString()}}).then((e=>{var a;const t=(null==(a=e.data)?void 0:a.data.token.toString())||"";202===e.status?(ae.replace({query:{token:t}}),oe.value.token=t):(async e=>{Y.setToken(e),ae.push("/user/dashboard").then((()=>{J.setSidebarOpen(!0)}))})(e.data.data.token).then((()=>{te.success(le("Account exists. Logged in directly."))}))})).finally((()=>{Z.value=!1})):Z.value=!1})),(e,a)=>($(),d(z,{"header-title":e.$t("Register")},{default:p((()=>{var t;return[Z.value?($(),c("div",E,[v(m(B),{size:"small",description:"loading..."})])):($(),d(j,{key:1,title:e.$t("Register a {sitename} account",{sitename:null==(t=m(K).configs)?void 0:t.site.title})},{default:p((()=>{var t,l,r,o,s,i;return[oe.value.token?($(),d(m(D),{key:0,type:"info",class:"mb-4"},{default:p((()=>[g(y(e.$t("Register a new account and bind it. After binding, you can log in directly next time.")),1)])),_:1})):f("",!0),(null==(t=m(K).configs)?void 0:t.app.enable_registration)&&(null==(l=m(K).configs)?void 0:l.app.user_email_verify)&&(null==(r=m(K).configs)?void 0:r.app.user_phone_verify)?($(),d(m(R),{key:1,type:"segment",class:"mb-4",value:ie.value,"onUpdate:value":a[0]||(a[0]=e=>ie.value=e)},{default:p((()=>[v(m(S),{name:"email"},{default:p((()=>[g(y(e.$t("Register with Email")),1)])),_:1}),v(m(S),{name:"phone"},{default:p((()=>[g(y(e.$t("Register with Mobile Number")),1)])),_:1})])),_:1},8,["value"])):f("",!0),(null==(o=m(K).configs)?void 0:o.app.enable_registration)&&((null==(s=m(K).configs)?void 0:s.app.user_email_verify)||(null==(i=m(K).configs)?void 0:i.app.user_phone_verify))?($(),d(m(P),{key:2,ref_key:"formRef",ref:re,model:oe.value,"show-require-mark":!0,onSubmit:_(se,["prevent"])},{default:p((()=>{var t,l,r,o;return["email"===ie.value?($(),d(I,{key:0,size:"large",event:"register",email:oe.value.email,"onUpdate:email":a[1]||(a[1]=e=>oe.value.email=e),code:oe.value.code,"onUpdate:code":a[2]||(a[2]=e=>oe.value.code=e),"require-verify":null==(t=m(K).configs)?void 0:t.app.user_email_register_verify},null,8,["email","code","require-verify"])):f("",!0),"phone"===ie.value?($(),d(O,{key:1,size:"large",event:"register",phone:oe.value.phone,"onUpdate:phone":a[3]||(a[3]=e=>oe.value.phone=e),"country-code":oe.value.country_code,"onUpdate:countryCode":a[4]||(a[4]=e=>oe.value.country_code=e),code:oe.value.code,"onUpdate:code":a[5]||(a[5]=e=>oe.value.code=e),"require-verify":null==(l=m(K).configs)?void 0:l.app.user_phone_register_verify},null,8,["phone","country-code","code","require-verify"])):f("",!0),v(m(C),{label:e.$t("Username")},{default:p((()=>[v(m(A),{value:oe.value.username,"onUpdate:value":a[6]||(a[6]=e=>oe.value.username=e),"input-props":{required:!0},placeholder:e.$t("Please enter your username"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(C),{label:e.$t("Name")},{default:p((()=>[v(m(A),{value:oe.value.name,"onUpdate:value":a[7]||(a[7]=e=>oe.value.name=e),"input-props":{required:!0},placeholder:e.$t("Please enter your name"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(C),{label:e.$t("Password")},{default:p((()=>[v(m(A),{value:oe.value.password,"onUpdate:value":a[8]||(a[8]=e=>oe.value.password=e),placeholder:e.$t("Please enter your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(C),{label:e.$t("Confirm Password"),"show-feedback":!1},{default:p((()=>[v(m(A),{value:oe.value.password_confirmation,"onUpdate:value":a[9]||(a[9]=e=>oe.value.password_confirmation=e),placeholder:e.$t("Please confirm your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(C),null,{default:p((()=>[v(m(b),{type:"primary","attr-type":"submit",size:"large",strong:"",block:""},{icon:p((()=>[v(m(L),{component:m(T)},null,8,["component"])])),default:p((()=>[g(" "+y(e.$t("Register")),1)])),_:1})])),_:1}),h("div",F,[a[11]||(a[11]=h("div",null,null,-1)),h("p",null,[g(y(e.$t("Already have an account?"))+" ",1),v(m(b),{text:"",type:"info",onClick:a[10]||(a[10]=e=>m(ae).push({path:"/login",query:{token:oe.value.token||void 0}}))},{default:p((()=>[g(y(e.$t("Go to Login")),1)])),_:1})])]),!oe.value.token&&((null==(r=m(K).configs)?void 0:r.app.socialites)||[]).length>0?($(),c("div",G,[h("div",M,[a[12]||(a[12]=h("div",{class:"absolute top-[10px] h-[1px] bg-gray-200 dark:bg-gray-500 w-[80%] z-[1]"},null,-1)),h("p",V,y(e.$t("Register with Other Methods")),1)]),h("div",W,[($(!0),c(w,null,k(null==(o=m(K).configs)?void 0:o.app.socialites,(e=>($(),d(m(b),{text:"",onClick:a=>(async e=>{var a,t;const l=await x({path:{id:e.id.toString()},query:{redirect_url:`${N.getWithoutQueryUrl()}?driver_id=${e.id}`}});if("error"===(null==(a=l.data)?void 0:a.status))return te.error(null==(t=l.data)?void 0:t.message);window.location.replace(l.data.data.redirect_url)})(e)},{icon:p((()=>[v(m(L),{component:m(N).getSocialiteIcon(e.provider)},null,8,["component"])])),default:p((()=>[g(" "+y(e.name),1)])),_:2},1032,["onClick"])))),256))])])):f("",!0)]})),_:1},8,["model"])):($(),c("div",Q,y(e.$t("The system has closed the registration")),1))]})),_:1},8,["title"]))]})),_:1},8,["header-title"]))}});export{X as default};
