import{d as e,b as t,e as o,g as s,aD as a,ck as i,cl as l,k as n,a as r,p as u,q as d,B as p,ar as c,A as h,E as v,y as f,D as k,cm as g,cn as x,co as y,cp as m,c as w,h as _,F as b,v as U,C as z,x as C,G as j,U as L,a2 as q,an as I,az as R,u as A,_ as B}from"./index-HMHCBO22.js";import{P}from"./WaterfallLayout-Bhg1tzW2.js";import{a as S,k as $,g as E,j as O,n as D,c as F,d as N,N as T,ak as G}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";const H={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},M=[s("path",{d:"M352.92 80C288 80 256 144 256 144s-32-64-96.92-64c-52.76 0-94.54 44.14-95.08 96.81c-1.1 109.33 86.73 187.08 183 252.42a16 16 0 0 0 18 0c96.26-65.34 184.09-143.09 183-252.42c-.54-52.67-42.32-96.81-95.08-96.81z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)],W=e({name:"HeartOutline",render:function(e,s){return o(),t("svg",H,M)}}),J=a("explore",(()=>({photoLiked:async function(e){return await i({path:{id:e}})},photoUnlinked:async function(e){return await l({path:{id:e}})}}))),K={class:"flex flex-col space-y-4"},Q={class:"flex justify-end"},V=e({__name:"Report",props:{type:{type:String,required:!0}},setup(e,{expose:t}){const{t:a}=n(),i=e,l={album:a("Album"),photo:a("Photo"),user:a("User"),share:a("Share")},w=S(),_=r(!1),b=r(),U=r({content:""}),z={},C=r({});async function j(){var e,t;const o={photo:m,album:y,user:x,share:g},s=await o[i.type]({body:{content:U.value.content},...C.value});if("error"===(null==(e=s.data)?void 0:e.status))return w.error(null==(t=s.data)?void 0:t.message);w.success(a("Report submitted successfully. Thank you for your feedback!")),L()}function L(){_.value=!1}return t({open:function(e){C.value=e,_.value=!0},close:L}),(t,a)=>(o(),u(p(c),{show:_.value,"onUpdate:show":a[1]||(a[1]=e=>_.value=e),title:`举报${l[e.type]}`,preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto"},{action:d((()=>[s("div",Q,[h(p(k),{tertiary:"",onClick:j},{default:d((()=>[v(f(t.$t("Confirm Report")),1)])),_:1})])])),default:d((()=>[s("div",K,[h(p(O),{ref_key:"reportFormRef",ref:b,model:U.value,rules:z},{default:d((()=>[h(p($),{label:t.$t("Please describe the reason for reporting"),path:"content"},{default:d((()=>[h(p(E),{resizable:"",type:"textarea",value:U.value.content,"onUpdate:value":a[0]||(a[0]=e=>U.value.content=e)},null,8,["value"])])),_:1},8,["label"])])),_:1},8,["model"])])])),_:1},8,["show","title"]))}}),X={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-sm"},Y={key:0,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},Z={key:1,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},ee=["src","alt"],te={class:"bg-gradient-to-t from-black via-black/80 to-transparent p-2 space-y-1"},oe={class:"text-xs font-medium truncate"},se={class:"text-xs opacity-90"},ae={class:"sm:hidden space-y-0.5"},ie={class:"hidden sm:block truncate"},le={key:0,class:"flex gap-1 flex-wrap"},ne={key:0,class:"text-xs opacity-70"},re={class:"flex items-center justify-between space-x-2 pt-1"},ue={key:0,class:"flex items-center min-w-0 flex-1"},de={class:"ml-2 min-w-0"},pe={key:1,class:"shrink-0"},ce={class:"text-white text-xs hidden sm:inline"},he={class:"flex gap-2"},ve=["onClick"],fe=["onClick"],ke={class:"text-white text-xs"},ge={class:"explore-photo-info"},xe={key:0,class:"user-section"},ye={class:"user-details"},me={class:"user-name"},we={class:"user-username"},_e=B(e({__name:"ExploreImage",props:{photo:{type:Object,required:!0,default:()=>{}},photos:{type:Array,required:!1,default:()=>[]},showUserInfo:{type:Boolean,required:!1,default:()=>!0},showLike:{type:Boolean,required:!1,default:()=>!0},showReport:{type:Boolean,required:!1,default:()=>!0}},setup(e){const a=e,i=r(!1),l=r(null),n=r(),c={showThumbnails:!0,showDrawer:!0,drawerConfig:{defaultOpen:!0,title:"图片信息"},controls:{showClose:!0,showInfo:!0,showNavigation:!0}},v=w((()=>(a.photos.length>0?a.photos:[a.photo]).map((e=>({id:e.id,src:e.public_url||e.src,thumbnail:e.thumbnail_url,name:e.name,width:e.width,height:e.height,size:e.size,extension:e.extension,tags:e.tags,user:e.user,is_liked:e.is_liked,is_public:e.is_public,created_at:e.created_at,updated_at:e.updated_at}))))),g=r(!0),x=r(!1),y=J(),m=A(),B=_();function S(){if(a.photo.is_liked){if(y.photoUnlinked(a.photo.id),a.photo.is_liked=!1,a.photos.length>0){const e=a.photos.find((e=>e.id===a.photo.id));e&&(e.is_liked=!1)}}else if(y.photoLiked(a.photo.id),a.photo.is_liked=!0,a.photos.length>0){const e=a.photos.find((e=>e.id===a.photo.id));e&&(e.is_liked=!0)}}function $(){m.push(`/explore/@${a.photo.user.username}`).then((()=>B.setSidebarOpen(!1)))}function E(){n.value=a.photo.id,i.value=!0}function O(){g.value=!1,x.value=!1}function H(){g.value=!1,x.value=!0}return(e,r)=>(o(),t(b,null,[s("div",{class:"relative group overflow-hidden w-full cursor-zoom-in bg-gray-100 dark:bg-gray-800 rounded-sm",onClick:E,style:U({paddingBottom:(a.photo.width&&a.photo.height?a.photo.height/a.photo.width*100:75)+"%"})},[g.value||x.value?(o(),t("div",X,[g.value?(o(),t("div",Y," 努力加载中... ")):x.value?(o(),t("div",Z," 加载失败 ")):z("",!0)])):z("",!0),s("img",{src:a.photo.thumbnail_url,alt:a.photo.name,class:C(["absolute inset-0 w-full h-full object-cover transition-all duration-300 group-hover:scale-105",{"opacity-0":g.value||x.value,"opacity-100":!g.value&&!x.value}]),loading:"lazy",onLoad:O,onError:H},null,42,ee),s("div",{class:C(["absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300",{"pointer-events-none":g.value||x.value}])},null,2),s("div",{class:C(["absolute bottom-0 left-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-white",{"pointer-events-none":g.value||x.value}])},[s("div",te,[s("div",oe,f(a.photo.name||"Untitled"),1),s("div",se,[s("div",ae,[s("div",null,f((a.photo.extension||"Unknown").toUpperCase()),1),s("div",null,f(a.photo.width||0)+" × "+f(a.photo.height||0),1),s("div",null,f(p(D).fileSize(a.photo.size||0)),1)]),s("div",ie,f((a.photo.extension||"Unknown").toUpperCase())+" • "+f(a.photo.width||0)+" × "+f(a.photo.height||0)+" • "+f(p(D).fileSize(a.photo.size||0)),1)]),a.photo.tags&&a.photo.tags.length>0?(o(),t("div",le,[(o(!0),t(b,null,j(a.photo.tags.slice(0,2),(e=>(o(),t("span",{key:e.id,class:"bg-white bg-opacity-20 rounded px-1 text-xs max-w-16 truncate"},f(e.name),1)))),128)),a.photo.tags.length>2?(o(),t("span",ne,"+"+f(a.photo.tags.length-2),1)):z("",!0)])):z("",!0),s("div",re,[a.showUserInfo?(o(),t("div",ue,[h(p(F),{class:"shrink-0 cursor-pointer z-10",round:"",size:16,src:p(N).getUserAvatar(a.photo.user.avatar_url),onClick:L($,["stop"])},null,8,["src"]),s("div",de,[s("a",{href:"javascript:void(0)",onClick:L($,["stop"]),class:"text-white text-xs truncate block hover:text-gray-200"},f(a.photo.user.name),1)])])):z("",!0),a.showLike?(o(),t("div",pe,[h(p(k),{quaternary:"",size:"tiny",class:"z-10 relative",type:a.photo.is_liked?"error":"default","render-icon":()=>q(p(T),{size:12},{default:()=>q(a.photo.is_liked?p(G):p(W))}),onClick:L(S,["stop"])},{default:d((()=>[s("span",ce,f(e.$t("Like")),1)])),_:1},8,["type","render-icon"])])):z("",!0)])])],2)],4),h(p(P),{show:i.value,"onUpdate:show":r[0]||(r[0]=e=>i.value=e),"current-photo-id":n.value,"onUpdate:currentPhotoId":r[1]||(r[1]=e=>n.value=e),photos:v.value,config:c,"onPhoto:change":r[2]||(r[2]=e=>{})},{"top-right":d((({photo:e})=>[s("div",he,[a.showLike?(o(),t("button",{key:0,class:"viewer-button",onClick:t=>function(e){if(e.is_liked){if(y.photoUnlinked(e.id),e.is_liked=!1,a.photos.length>0){const t=a.photos.find((t=>t.id===e.id));t&&(t.is_liked=!1)}a.photo.id===e.id&&(a.photo.is_liked=!1)}else{if(y.photoLiked(e.id),e.is_liked=!0,a.photos.length>0){const t=a.photos.find((t=>t.id===e.id));t&&(t.is_liked=!0)}a.photo.id===e.id&&(a.photo.is_liked=!0)}}(e)},[h(p(I),{icon:e.is_liked?"fa-solid fa-heart":"fa-regular fa-heart",class:C(["text-sm",{"text-red-500":e.is_liked,"text-white":!e.is_liked}])},null,8,["icon","class"])],8,ve)):z("",!0),a.showReport?(o(),t("button",{key:1,class:"viewer-button",onClick:t=>{return o=e,void(null==(s=l.value)||s.open({path:{id:o.id}}));var o,s}},[h(p(I),{icon:"fa-solid fa-flag",class:"text-sm text-white"})],8,fe)):z("",!0)])])),"top-left":d((({photo:e})=>[a.showUserInfo&&e.user?(o(),t("div",{key:0,class:"flex items-center gap-2 cursor-pointer bg-gray-600/80 hover:bg-gray-600/60 rounded-full px-3 py-2",onClick:$},[h(p(F),{round:"",size:20,src:p(N).getUserAvatar(e.user.avatar_url)},null,8,["src"]),s("span",ke,f(e.user.name),1)])):z("",!0)])),"drawer-content":d((({photo:e})=>[s("div",ge,[a.showUserInfo&&e.user?(o(),t("div",xe,[r[3]||(r[3]=s("h4",{class:"section-title"},"上传者",-1)),s("div",{class:"user-card",onClick:$},[h(p(F),{round:"",size:40,src:p(N).getUserAvatar(e.user.avatar_url)},null,8,["src"]),s("div",ye,[s("div",me,f(e.user.name),1),s("div",we,"@"+f(e.user.username),1)])])])):z("",!0)])])),_:1},8,["show","current-photo-id","photos"]),(o(),u(R,{to:"body"},[h(V,{ref_key:"reportRef",ref:l,type:"photo"},null,512)]))],64))}}),[["__scopeId","data-v-acac7a08"]]);export{_e as E,V as _};
