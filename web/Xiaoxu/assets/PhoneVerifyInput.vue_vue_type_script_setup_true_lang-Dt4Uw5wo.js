import{d as e,bZ as a,aR as l,k as t,a as u,c as r,o as i,p as s,B as o,q as d,g as n,A as c,v,x as p,b as f,D as h,E as m,y,b_ as b,e as g,M as k,ai as C,C as z,F as _,bY as V,i as S,bV as q}from"./index-HMHCBO22.js";import{a as w,f as x,g as $,k as M,l as P}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";const U={class:"flex items-center w-full"},E=["src"],I=e({__name:"CaptchaInput",props:a({disabled:{type:Boolean,default:!1},size:{type:String,default:()=>"medium"}},{captcha:{default:""},captchaModifiers:{},captchaKey:{default:""},captchaKeyModifiers:{}}),emits:["update:captcha","update:captchaKey"],setup(e){const a=e,k=l(e,"captcha"),C=l(e,"captchaKey"),{t:z}=t(),_=w(),V=u(""),S=u(!1),q=u(!1),M=u(0),P=r((()=>{switch(a.size){case"small":return"28px";case"large":return"40px";default:return"34px"}})),I=async(e=!1)=>{try{S.value=!0,q.value=!1,e||(M.value=0);const l=(await b()).data;if(!(l&&l.data&&l.data.img))throw new Error("Invalid response structure");{const e=(a=l.data.img)?a.startsWith("data:image/")?a:`data:image/png;base64,${a}`:"";V.value=e,C.value=l.data.key,k.value="",M.value=0}}catch(l){if(M.value<3&&!e)return M.value++,void setTimeout((()=>I(!0)),1e3);q.value=!0,_.error(z("Failed to load captcha"))}finally{S.value=!1}var a},B=()=>{q.value=!1},K=()=>{_.error(z("Failed to load captcha image")),V.value="",q.value=!0};return i((()=>{I()})),(e,l)=>(g(),s(o(x),null,{default:d((()=>[n("div",U,[c(o($),{value:k.value,"onUpdate:value":l[0]||(l[0]=e=>k.value=e),placeholder:e.$t("Please enter captcha"),disabled:a.disabled,size:a.size,class:"flex-1"},null,8,["value","placeholder","disabled","size"]),n("div",{class:p(["ml-2 flex items-center cursor-pointer",{"opacity-50":S.value}]),onClick:l[2]||(l[2]=()=>I(!1)),style:v({height:P.value})},[V.value?(g(),f("div",{key:0,class:"overflow-hidden rounded-md border border-[#d9d9d9] dark:border-[#383838] h-full bg-gray-50 dark:bg-gray-800",style:v({minHeight:P.value,minWidth:"80px"})},[n("img",{src:V.value,alt:"captcha",class:"h-full w-full object-contain",style:v({maxHeight:P.value,minHeight:P.value,display:"block"}),onLoad:B,onError:K,loading:"eager"},null,44,E)],4)):(g(),s(o(h),{key:1,onClick:l[1]||(l[1]=()=>I(!1)),loading:S.value,size:a.size,class:"h-full"},{default:d((()=>[m(y(q.value||M.value>0?e.$t("Retry"):e.$t("Load Captcha")),1)])),_:1},8,["loading","size"]))],6)])])),_:1}))}}),B=e({__name:"EmailVerifyInput",props:a({event:{type:String,required:!0},size:{type:String,default:()=>"medium"},modelValue:{type:String,default:void 0},disabled:{type:Boolean,default:!1},requireVerify:{type:Boolean,default:!0}},{email:{default:""},emailModifiers:{},code:{default:""},codeModifiers:{}}),emits:["update:email","update:code"],setup(e){const a=e,i=l(e,"email"),n=l(e,"code"),v=u(""),p=u("");k((()=>a.modelValue),(e=>{e&&e!==i.value&&(i.value=e)}),{immediate:!0});const{t:b}=t(),S=w(),q=u(b("Send Email Verification Code")),P=u(!1),U=r((()=>a.modelValue&&a.modelValue.length>0||i.value.length>0)),E=async()=>{var e;const l=a.modelValue||i.value.toString();if(!U.value)return S.error(b("Please enter your email first"));if(!v.value)return S.error(b("Please enter captcha"));if(!p.value)return S.error(b("Captcha key is missing, please refresh the captcha"));const t=await V({body:{event:a.event,email:l,captcha:v.value,captcha_key:p.value}});"success"===(null==(e=t.data)?void 0:e.status)?(()=>{let e=60;P.value=!0;const a=setInterval((()=>{e--,q.value=b("Resend after {seconds} seconds",{seconds:e}),e<=0&&(P.value=!1,q.value=b("Send Email Verification Code"),clearInterval(a))}),1e3)})():S.error(t.data.message)};return(l,t)=>a.disabled?C(l.$slots,"default",{key:0,sendVerifyCode:E,btnDisabled:P.value,btnText:q.value}):(g(),f(_,{key:1},[c(o(M),{label:l.$t("Email"),"show-require-mark":""},{default:d((()=>[c(o(x),null,{default:d((()=>[c(o($),{value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),"input-props":{type:"email",required:!0},placeholder:l.$t("Please enter your email"),size:a.size},null,8,["value","placeholder","size"])])),_:1})])),_:1},8,["label"]),e.requireVerify?(g(),f(_,{key:0},[U.value?(g(),s(o(M),{key:0,label:l.$t("Captcha"),"show-require-mark":""},{default:d((()=>[c(I,{captcha:v.value,"onUpdate:captcha":t[1]||(t[1]=e=>v.value=e),"captcha-key":p.value,"onUpdate:captchaKey":t[2]||(t[2]=e=>p.value=e),size:a.size},null,8,["captcha","captcha-key","size"])])),_:1},8,["label"])):z("",!0),v.value?(g(),s(o(M),{key:1,label:l.$t("Email Verification Code"),"show-require-mark":""},{default:d((()=>[c(o($),{value:n.value,"onUpdate:value":t[3]||(t[3]=e=>n.value=e),"input-props":{required:!0},placeholder:l.$t("Please enter the email verification code"),size:a.size},{suffix:d((()=>[c(o(h),{text:"",type:"info",onClick:E,disabled:P.value||!a.modelValue&&!i.value||U.value&&!v.value},{default:d((()=>[m(y(q.value),1)])),_:1},8,["disabled"])])),_:1},8,["value","placeholder","size"])])),_:1},8,["label"])):z("",!0)],64)):z("",!0)],64))}}),K=e({__name:"PhoneVerifyInput",props:a({event:{type:String,required:!0},size:{type:String,default:()=>"medium"},modelValue:{type:String,default:void 0},modelValueCountryCode:{type:String,default:void 0},disabled:{type:Boolean,default:!1},requireVerify:{type:Boolean,default:!0}},{countryCode:{default:"cn"},countryCodeModifiers:{},phone:{default:""},phoneModifiers:{},code:{default:""},codeModifiers:{}}),emits:["update:countryCode","update:phone","update:code"],setup(e){const a=e,i=l(e,"countryCode"),n=l(e,"phone"),v=l(e,"code"),p=u(""),b=u("");k((()=>a.modelValue),(e=>{e&&e!==n.value&&(n.value=e)}),{immediate:!0}),k((()=>a.modelValueCountryCode),(e=>{e&&e!==i.value&&(i.value=e)}),{immediate:!0});const{t:V}=t(),U=w(),E=S(),B=u(V("Send SMS Verification Code")),K=u(!1),R=r((()=>a.modelValue&&a.modelValue.length>0||n.value.length>0)),j=E.getSelectOptionCountryCodes(),D=e=>{var a,l;return(null==(l=null==(a=e.option.label)?void 0:a.toString())?void 0:l.match(/^\+\d+/))||""},F=async()=>{var e;const l=a.modelValue||n.value.toString(),t=a.modelValueCountryCode||i.value.toString();if(!R.value)return U.error(V("Please enter your mobile number first"));if(!p.value)return U.error(V("Please enter captcha"));if(!b.value)return U.error(V("Captcha key is missing, please refresh the captcha"));const u=await q({body:{event:a.event,country_code:t,phone:l,captcha:p.value,captcha_key:b.value}});"success"===(null==(e=u.data)?void 0:e.status)?(()=>{let e=60;K.value=!0;const a=setInterval((()=>{e--,B.value=V("Resend after {seconds} seconds",{seconds:e}),e<=0&&(K.value=!1,B.value=V("Send SMS Verification Code"),clearInterval(a))}),1e3)})():U.error(u.data.message)};return(l,t)=>a.disabled?C(l.$slots,"default",{key:0,sendVerifyCode:F,btnDisabled:K.value,btnText:B.value}):(g(),f(_,{key:1},[c(o(M),{label:l.$t("Mobile Number"),"show-require-mark":""},{default:d((()=>[c(o(x),null,{default:d((()=>[c(o(P),{options:o(j),"render-tag":D,"consistent-menu-width":!1,value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),class:"w-40",size:a.size,filterable:"",placeholder:l.$t("Select Country")},null,8,["options","value","size","placeholder"]),c(o($),{value:n.value,"onUpdate:value":t[1]||(t[1]=e=>n.value=e),placeholder:l.$t("Please enter your mobile number"),"input-props":{required:!0},size:a.size},null,8,["value","placeholder","size"])])),_:1})])),_:1},8,["label"]),e.requireVerify?(g(),f(_,{key:0},[R.value?(g(),s(o(M),{key:0,label:l.$t("Captcha"),"show-require-mark":""},{default:d((()=>[c(I,{captcha:p.value,"onUpdate:captcha":t[2]||(t[2]=e=>p.value=e),"captcha-key":b.value,"onUpdate:captchaKey":t[3]||(t[3]=e=>b.value=e),size:a.size},null,8,["captcha","captcha-key","size"])])),_:1},8,["label"])):z("",!0),p.value?(g(),s(o(M),{key:1,label:l.$t("SMS Verification Code"),"show-require-mark":""},{default:d((()=>[c(o($),{value:v.value,"onUpdate:value":t[4]||(t[4]=e=>v.value=e),"input-props":{required:!0},placeholder:l.$t("Please enter the SMS verification code"),size:a.size},{suffix:d((()=>[c(o(h),{text:"",type:"info",onClick:F,disabled:K.value||!a.modelValue&&!n.value||R.value&&!p.value},{default:d((()=>[m(y(B.value),1)])),_:1},8,["disabled"])])),_:1},8,["value","placeholder","size"])])),_:1},8,["label"])):z("",!0)],64)):z("",!0)],64))}});export{B as _,K as a,I as b};
