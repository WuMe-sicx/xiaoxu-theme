import{Z as e,bC as s,d as a,a2 as l,bD as t,bk as i,a3 as r,aJ as o,bE as n,a5 as u,c as d,aL as c,k as p,a as m,p as v,e as f,q as h,b as y,C as b,A as _,y as g,B as x,F as k,G as w,g as C,E as P,D as j,U as z,R as $,_ as G,o as A,ar as T,bF as D,an as O,u as E,bG as S}from"./index-HMHCBO22.js";import{a9 as M,T as N,N as R,K as B,M as H,a as V,_ as U,L as F,j as I,k as L,g as q,x as J,y as K}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";import{_ as Z}from"./Content.vue_vue_type_script_setup_true_lang-BU2yl4QK.js";import{_ as Q}from"./Back.vue_vue_type_script_setup_true_lang-CqzeplWU.js";import{N as W,a as X}from"./CollapseItem-BzPm4vx0.js";import{N as Y,a as ee}from"./ListItem-C1dIomV8.js";import{N as se}from"./Checkbox-dOjwP0iZ.js";import{N as ae}from"./Divider-DiCGOzPp.js";import{N as le}from"./Alert-Dp99rEM1.js";const te=e("collapse-transition",{width:"100%"},[s()]),ie=a({name:"CollapseTransition",props:Object.assign(Object.assign({},o.props),{show:{type:Boolean,default:!0},appear:Boolean,collapsed:{type:Boolean,default:void 0}}),inheritAttrs:!1,setup(e){const{mergedClsPrefixRef:s,inlineThemeDisabled:a,mergedRtlRef:l}=r(e),t=o("CollapseTransition","-collapse-transition",te,n,e,s),i=u("CollapseTransition",l,s),p=d((()=>void 0!==e.collapsed?e.collapsed:e.show)),m=d((()=>{const{self:{bezier:e}}=t.value;return{"--n-bezier":e}})),v=a?c("collapse-transition",void 0,m,e):void 0;return{rtlEnabled:i,mergedShow:p,mergedClsPrefix:s,cssVars:a?void 0:m,themeClass:null==v?void 0:v.themeClass,onRender:null==v?void 0:v.onRender}},render(){return l(t,{appear:this.appear},{default:()=>{var e;if(this.mergedShow)return null===(e=this.onRender)||void 0===e||e.call(this),l("div",i({class:[`${this.mergedClsPrefix}-collapse-transition`,this.rtlEnabled&&`${this.mergedClsPrefix}-collapse-transition--rtl`,this.themeClass],style:this.cssVars},this.$attrs),this.$slots)}})}}),re={class:"flex gap-2 items-center"},oe={class:"flex gap-1"},ne={key:0,class:"text-sm text-gray-500 mb-3"},ue={class:"flex items-center justify-between"},de=["onClick"],ce={class:"flex items-center justify-between"},pe=["onClick"],me={key:0,class:"mt-4 px-2"},ve={class:"space-y-2"},fe={class:"font-medium"},he={class:"text-sm text-gray-500 mt-1"},ye=G(a({__name:"PermissionCard",props:{title:{},description:{},permissions:{},selectedPermissions:{},subGroups:{}},emits:["update:selectedPermissions"],setup(e,{emit:s}){const{t:a}=p(),l=e,t=s;m(!0);const i=m(!1),r=d((()=>l.permissions.every((e=>l.selectedPermissions.includes(e.value))))),o=d((()=>l.permissions.some((e=>l.selectedPermissions.includes(e.value)))&&!r.value)),n=d((()=>l.permissions.filter((e=>l.selectedPermissions.includes(e.value))).length)),u=e=>{const s=[...l.selectedPermissions],a=s.indexOf(e);-1===a?s.push(e):s.splice(a,1),t("update:selectedPermissions",s)},c=()=>{const e=[...l.selectedPermissions];l.permissions.forEach((s=>{e.includes(s.value)||e.push(s.value)})),t("update:selectedPermissions",e)},G=()=>{const e=l.permissions.map((e=>e.value)),s=l.selectedPermissions.filter((s=>!e.includes(s)));t("update:selectedPermissions",s)},A=()=>{i.value=!i.value},T=e=>{if(!l.subGroups||!l.subGroups[e])return!1;return l.subGroups[e].permissions.map((e=>e.value)).every((e=>l.selectedPermissions.includes(e)))},D=e=>{if(!l.subGroups||!l.subGroups[e])return!1;return l.subGroups[e].permissions.map((e=>e.value)).some((e=>l.selectedPermissions.includes(e)))&&!T(e)};return(e,s)=>(f(),v(x($),{title:e.title,class:"permission-card mb-4",size:"small",bordered:!0,segmented:{content:!0,footer:"soft"}},{"header-extra":h((()=>[C("div",re,[_(x(H),{value:n.value,max:99,"show-zero":!1,offset:[2,2]},{default:h((()=>[_(x(B),{type:r.value?"success":o.value?"warning":"default",size:"small",bordered:!1},{default:h((()=>[P(g(r.value?x(a)("All Selected"):o.value?x(a)("Partially Selected"):x(a)("None Selected")),1)])),_:1},8,["type"])])),_:1},8,["value"]),C("div",oe,[_(x(j),{size:"tiny",onClick:c,type:"primary",secondary:""},{default:h((()=>[P(g(x(a)("Select All")),1)])),_:1}),_(x(j),{size:"tiny",onClick:G,secondary:""},{default:h((()=>[P(g(x(a)("Cancel")),1)])),_:1}),_(x(j),{size:"tiny",onClick:A,tertiary:""},{default:h((()=>[P(g(i.value?x(a)("Hide Details"):x(a)("Show Details")),1)])),_:1})])])])),default:h((()=>[e.description?(f(),y("div",ne,g(e.description),1)):b("",!0),e.subGroups&&Object.keys(e.subGroups).length>0?(f(),v(x(W),{key:1,class:"mb-2"},{default:h((()=>[(f(!0),y(k,null,w(e.subGroups,((i,r)=>(f(),v(x(X),{key:r,title:i.name},{"header-extra":h((()=>[C("div",{class:"flex gap-1 mr-2",onClick:s[0]||(s[0]=z((()=>{}),["stop"]))},[_(x(j),{size:"tiny",onClick:e=>(e=>{if(!l.subGroups||!l.subGroups[e])return;const s=[...l.selectedPermissions];l.subGroups[e].permissions.forEach((e=>{s.includes(e.value)||s.push(e.value)})),t("update:selectedPermissions",s)})(r),type:"primary",secondary:"",disabled:T(r)},{default:h((()=>[P(g(x(a)("Select All")),1)])),_:2},1032,["onClick","disabled"]),_(x(j),{size:"tiny",onClick:e=>(e=>{if(!l.subGroups||!l.subGroups[e])return;const s=l.subGroups[e].permissions.map((e=>e.value)),a=l.selectedPermissions.filter((e=>!s.includes(e)));t("update:selectedPermissions",a)})(r),secondary:"",disabled:!D(r)&&!T(r)},{default:h((()=>[P(g(x(a)("Cancel")),1)])),_:2},1032,["onClick","disabled"])])])),default:h((()=>[_(x(Y),{hoverable:""},{default:h((()=>[(f(!0),y(k,null,w(i.permissions,(a=>(f(),v(x(ee),{key:a.value},{default:h((()=>[C("div",ue,[C("div",{class:"flex items-center gap-2 flex-1 cursor-pointer",onClick:e=>u(a.value)},[_(x(se),{checked:e.selectedPermissions.includes(a.value)},null,8,["checked"]),_(x(M),{type:e.selectedPermissions.includes(a.value)?"primary":void 0},{default:h((()=>[P(g(a.label),1)])),_:2},1032,["type"])],8,de),a.detail?(f(),v(x(N),{key:0,trigger:"hover",placement:"top"},{trigger:h((()=>[_(x(R),{class:"cursor-help text-gray-400 hover:text-primary"},{default:h((()=>s[1]||(s[1]=[C("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"1em",height:"1em"},[C("path",{fill:"currentColor",d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"})],-1)]))),_:1,__:[1]})])),default:h((()=>[P(" "+g(a.detail),1)])),_:2},1024)):b("",!0)])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["title"])))),128))])),_:1})):(f(),v(x(Y),{key:2,hoverable:""},{default:h((()=>[(f(!0),y(k,null,w(e.permissions,(a=>(f(),v(x(ee),{key:a.value},{default:h((()=>[C("div",ce,[C("div",{class:"flex items-center gap-2 flex-1 cursor-pointer",onClick:e=>u(a.value)},[_(x(se),{checked:e.selectedPermissions.includes(a.value)},null,8,["checked"]),_(x(M),{type:e.selectedPermissions.includes(a.value)?"primary":void 0},{default:h((()=>[P(g(a.label),1)])),_:2},1032,["type"])],8,pe),a.detail?(f(),v(x(N),{key:0,trigger:"hover",placement:"top"},{trigger:h((()=>[_(x(R),{class:"cursor-help text-gray-400 hover:text-primary"},{default:h((()=>s[2]||(s[2]=[C("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"1em",height:"1em"},[C("path",{fill:"currentColor",d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"})],-1)]))),_:1,__:[2]})])),default:h((()=>[P(" "+g(a.detail),1)])),_:2},1024)):b("",!0)])])),_:2},1024)))),128))])),_:1})),_(x(ie),null,{default:h((()=>[i.value?(f(),y("div",me,[_(x(ae),null,{default:h((()=>[P(g(x(a)("Permission Details")),1)])),_:1}),C("div",ve,[(f(!0),y(k,null,w(e.permissions,(e=>(f(),y("div",{key:`detail-${e.value}`,class:"p-2 rounded hover:bg-gray-50"},[C("div",fe,[P(g(e.label)+" ",1),_(x(B),{size:"small"},{default:h((()=>[P(g(e.value),1)])),_:2},1024)]),C("div",he,g(e.detail),1)])))),128))])])):b("",!0)])),_:1})])),_:1},8,["title"]))}}),[["__scopeId","data-v-fd9fae23"]]),be={class:"space-x-2"},_e={class:"flex flex-col gap-4"},ge={class:"flex justify-between items-center mb-2 flex-wrap gap-2"},xe={class:"flex gap-2"},ke={class:"flex flex-col space-y-4"},we={class:"flex justify-between space-x-2"},Ce=G(a({__name:"CreateView",setup(e){const s=V(),a=E(),{t:l}=p(),t=m(!1),i=m({abilities:[]}),r=m(null),o=m(!1),n=m(""),u=m([]),d=m({}),c=m({}),v=m({}),b={name:{type:"string",required:!0,trigger:["blur","input"],message:l("Please enter the token name")},expires_at:{type:"string",required:!1,trigger:["blur","input"],message:l("Please select the token expiration time")}},G=()=>{i.value.abilities=u.value.map((e=>e.value))},N=()=>{i.value.abilities=[]},R=e=>v.value&&v.value[e]&&Object.keys(v.value[e]).length>0,B=e=>{var s;return(null==(s=v.value)?void 0:s[e])||{}},H=e=>({user:"用户资料、令牌、角色组和容量等用户相关权限",content:"相册、照片、分享和图片上传等内容管理权限",service:"工单和订单等服务相关权限",integration:"OAuth绑定和内容探索等集成功能权限",basic:"基础功能权限，所有令牌默认拥有",oauth:"OAuth第三方账号绑定相关权限",explore:"内容探索和浏览相关权限",upload:"图片上传相关权限"}[e]||""),W=async e=>{var a;e.preventDefault(),null==(a=r.value)||a.validate((async e=>{var a,r,u,d,c;if(!e){t.value=!0;try{const e=Array.isArray(i.value.abilities)&&i.value.abilities.length>0?[...i.value.abilities]:["*"],l={name:i.value.name,abilities:e};i.value.expires_at&&(l.expires_at=i.value.expires_at);const t=new FormData;t.append("name",l.name),l.expires_at&&t.append("expires_at",l.expires_at);for(const s of l.abilities)t.append("abilities[]",s);const d=await S({body:t});if("error"===(null==(a=d.data)?void 0:a.status))return s.error(null==(r=d.data)?void 0:r.message);n.value=(null==(u=d.data)?void 0:u.data.token)||"",o.value=!0}catch(p){s.error((null==(c=null==(d=p.response)?void 0:d.data)?void 0:c.message)||l("Failed to create token"))}finally{t.value=!1}}}))},X=()=>{o.value=!1,a.push("/user/tokens")},Y=()=>{K.copyText(n.value).then((()=>{s.success(l("Copy successful")),setTimeout((()=>{a.push("/user/tokens")}),500)})).catch((()=>{s.error(l("Copy failed"))}))};return A((()=>{(async()=>{var e,a,t,i,r;try{const s=await D();if("success"===(null==(e=s.data)?void 0:e.status)){const e=(null==(t=null==(a=s.data)?void 0:a.data)?void 0:t.permissions)||[],l=(null==(r=null==(i=s.data)?void 0:i.data)?void 0:r.groups)||{};u.value=e,c.value=l;const o={};e.forEach((e=>{const s=e.category||e.value.split(":")[0];o[s]||(o[s]=[]),o[s].push(e)})),d.value=o;const n={};Object.entries(l).forEach((([s,a])=>{n[s]={},Object.entries(a).forEach((([a,l])=>{const t=l.map((s=>e.find((e=>e.value===s)))).filter((e=>void 0!==e));t.length>0&&(n[s][a]={name:a,permissions:t})}))})),v.value=n}}catch(o){s.error(l("Failed to get permissions"))}})()})),(e,s)=>(f(),y(k,null,[_(U,{"header-title":e.$t("Create Token"),"toggle-header":!1,"show-footer":!1},{default:h((()=>[_(Z,{class:"mx-auto p-4 md:p-10 space-y-10 overflow-hidden"},{default:h((()=>[_(x(F),{vertical:""},{default:h((()=>[C("div",be,[_(Q,{to:"/user/tokens"})]),_(x($),null,{default:h((()=>[_(x(I),{ref_key:"formRef",ref:r,"label-placement":"left","label-width":200,"label-align":"left",model:i.value,rules:b,onSubmit:z(W,["prevent"]),class:"form-container"},{default:h((()=>[_(x(L),{label:e.$t("Token Name"),path:"name"},{default:h((()=>[_(x(q),{value:i.value.name,"onUpdate:value":s[0]||(s[0]=e=>i.value.name=e),maxlength:20,placeholder:e.$t("Please enter the token name")},null,8,["value","placeholder"])])),_:1},8,["label"]),_(x(L),{label:e.$t("Token Expires Time"),path:"expires_at"},{default:h((()=>[_(x(J),{"formatted-value":i.value.expires_at,"onUpdate:formattedValue":s[1]||(s[1]=e=>i.value.expires_at=e),type:"datetime",class:"w-full","is-date-disabled":e=>e<Date.now(),"value-format":"yyyy-MM-dd HH:mm:ss",clearable:"",placeholder:e.$t("Please select the token expiration time")},null,8,["formatted-value","is-date-disabled","placeholder"])])),_:1},8,["label"]),_(x(L),{label:e.$t("Token Permissions"),path:"abilities"},{default:h((()=>[C("div",_e,[_(x(le),{type:"info","show-icon":""},{default:h((()=>[P(g(e.$t("The token created without choosing any permissions will have full access rights. Please select the permissions carefully based on your needs.")),1)])),_:1}),C("div",ge,[_(x(M),null,{default:h((()=>[P(g(e.$t("Permissions")),1)])),_:1}),C("div",xe,[_(x(j),{size:"small",onClick:G},{default:h((()=>[P(g(e.$t("Select All")),1)])),_:1}),_(x(j),{size:"small",onClick:N},{default:h((()=>[P(g(e.$t("Deselect All")),1)])),_:1})])]),_(x(F),{vertical:""},{default:h((()=>[(f(!0),y(k,null,w(d.value,((e,a)=>{return f(),y("div",{key:a},[_(ye,{title:(l=a,{user:"用户管理",content:"内容管理",service:"服务管理",integration:"集成功能",basic:"基础功能",oauth:"OAuth认证",explore:"探索功能",upload:"上传功能"}[l]||l),description:H(a),permissions:e,"selected-permissions":i.value.abilities,"sub-groups":R(a)?B(a):void 0,"onUpdate:selectedPermissions":s[2]||(s[2]=e=>i.value.abilities=e)},null,8,["title","description","permissions","selected-permissions","sub-groups"])]);var l})),128)),_(x(le),{type:"info",class:"mt-4"},{default:h((()=>[P(g(e.$t("Permission Principle")),1)])),_:1})])),_:1})])])),_:1},8,["label"]),_(x(L),{class:"flex justify-end"},{default:h((()=>[_(x(j),{"attr-type":"submit",type:"primary",loading:t.value},{default:h((()=>[P(g(e.$t("Confirm Creation")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1})])),_:1},8,["header-title"]),_(x(T),{show:o.value,"onUpdate:show":s[3]||(s[3]=e=>o.value=e),preset:"card",title:e.$t("Created successfully"),size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto max-h-[90vh] overflow-auto"},{action:h((()=>[C("div",we,[_(x(j),{tertiary:"",onClick:X},{default:h((()=>[P(g(e.$t("Close")),1)])),_:1}),_(x(j),{tertiary:"",type:"primary",class:"shrink-0",onClick:Y},{icon:h((()=>[_(x(O),{icon:"fa-solid fa-copy"})])),_:1})])])),default:h((()=>[C("div",ke,[_(x(le),{type:"warning","show-icon":""},{default:h((()=>[P(g(e.$t("Please keep it safe. This Token will no longer be displayed after the window is closed.")),1)])),_:1}),_(x(q),{class:"select-all",value:n.value,readonly:""},null,8,["value"])])])),_:1},8,["show","title"])],64))}}),[["__scopeId","data-v-457aaef6"]]);export{Ce as default};
