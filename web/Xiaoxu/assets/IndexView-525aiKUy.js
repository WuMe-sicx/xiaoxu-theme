import{_ as e}from"./Content.vue_vue_type_script_setup_true_lang-BU2yl4QK.js";import{g as l,v as a,w as t,a as s,n as o,_ as r,l as i,j as n,k as d,x as u,y as c}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";import{u as p,l as v}from"./album-DI7nO5SG.js";import{_ as f,a as m,b as h,c as b,d as y,e as g,f as _}from"./PhotoSelect.vue_vue_type_script_setup_true_lang-DvkvjMs6.js";import{d as w,k as x,a as k,M as S,p as j,B as $,ar as A,q as P,g as C,C as L,A as z,b as U,F as q,G as E,e as T,an as D,y as M,o as O,D as F,i as I,as as N,E as H,at as K}from"./index-HMHCBO22.js";import{N as B}from"./InfiniteScroll-Dgt10tIe.js";import{N as G}from"./Spin-DJBzsfd9.js";import"./WaterfallLayout-Bhg1tzW2.js";import"./ShareOutline-EQRXYPYI.js";import"./DeleteOutlined-D1D-Si2V.js";import"./composables-sjxCGT15.js";import"./Popconfirm-D7351gxE.js";const R={class:"flex flex-col space-y-4"},J={class:"flex justify-between w-full border-b pb-2 dark:border-b-gray-600"},V=["onClick"],W={class:"h-16 w-16 rounded-lg overflow-hidden shrink-0"},Q=["src"],X={key:1,class:"flex grow items-center justify-center h-full bg-gray-100 dark:bg-gray-700"},Y={class:"flex flex-col justify-center ml-4 overflow-hidden"},Z={key:0,class:"truncate text-lg"},ee={class:"truncate text-gray-500"},le={key:0,class:"flex justify-center py-10"},ae=w({__name:"AlbumSelector",props:{title:{type:String,required:!1,default:"Select Album"}},emits:["onSelect"],setup(e,{expose:t,emit:s}){const o=p(),{t:r}=x(),i=e,n=s,d=k(!1),u=k("");function c(){d.value=!1}function f(){o.isLoading||(o.setPage(o.page+1),o.fetchAlbums())}return S((()=>u.value),v.debounce((()=>{o.resetAlbums({q:u})}),500)),t({open:function(){o.resetAlbums(),d.value=!0},close:c}),(e,t)=>(T(),j($(A),{show:d.value,"onUpdate:show":t[1]||(t[1]=e=>d.value=e),title:i.title,preset:"card",size:"small",bordered:!1,class:"container m-4 md:mx-auto md:my-10 max-w-screen-md overflow-hidden"},{default:P((()=>[C("div",R,[C("div",J,[z($(l),{placeholder:e.$t("Search Albums"),bordered:!1,value:u.value,"onUpdate:value":t[0]||(t[0]=e=>u.value=e)},null,8,["placeholder","value"])]),$(o).isLoading||0!==$(o).albums.length?L("",!0):(T(),j($(a),{key:0,class:"py-8",description:e.$t("No albums available")},null,8,["description"])),z($(B),{class:"max-h-[400px]",onLoad:f},{default:P((()=>[(T(!0),U(q,null,E($(o).albums,(l=>(T(),U("div",{class:"flex p-2 mb-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",onClick:e=>function(e){var l;o.toggleSelect((null==(l=e.id)?void 0:l.toString())||""),n("onSelect",o.selections),c()}(l)},[C("div",W,[l.covers&&l.covers.length>0?(T(),U("img",{key:0,class:"rounded-lg w-full h-full object-cover",alt:"album cover",src:l.covers[0]},null,8,Q)):(T(),U("div",X,[z($(D),{icon:"fa-solid fa-images",class:"text-gray-500",size:"xl"})]))]),C("div",Y,[l.name?(T(),U("div",Z,M(l.name),1)):L("",!0),C("div",ee,M(e.$t("{count} items",{count:l.photo_count})),1)])],8,V)))),256)),$(o).isLoading?(T(),U("div",le,[z($(G),{size:25})])):L("",!0)])),_:1})])])),_:1},8,["show","title"]))}}),te=w({__name:"PhotoToAlbum",setup(e){const l=t(),a=k(null),o=s(),{t:r}=x();function i(){var e;null==(e=a.value)||e.open()}function n(e){l.selectedToAlbum(e).then((()=>{o.success(r("Added successfully"))})).catch((e=>{o.error(r("Failed to add to album"))}))}return O((()=>{l.setAlbumSelectorRef(a.value)})),(e,l)=>(T(),U(q,null,[z(ae,{ref_key:"albumSelectorRef",ref:a,title:e.$t("Add to Album"),onOnSelect:n},null,8,["title"]),z($(F),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Add to Album"),onClick:i},{icon:P((()=>[z($(D),{icon:"fa-solid fa-plus"})])),_:1},8,["title"])],64))}}),se=w({__name:"PhotoShare",setup(e){const{t:l}=x(),a=t();return(e,l)=>(T(),j($(F),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Share"),onClick:l[0]||(l[0]=e=>$(a).setShareModalActive(!0))},{icon:P((()=>[z($(D),{icon:"fa-solid fa-share-nodes"})])),_:1},8,["title"]))}}),oe={class:"flex items-center justify-between space-x-2 sticky top-0 z-[4] bg-gray-100 border-b border-transparent dark:bg-[var(--n-color)] dark:border-b-gray-800 p-2 w-full"},re={class:"flex justify-end space-x-2 grow md:grow-0 md:w-2/3"},ie={class:"flex flex-col"},ne={class:"space-y-4 p-2"},de={class:"flex flex-col space-y-4"},ue={key:0,class:"flex justify-end"},ce={key:1,class:"flex justify-between space-x-2"},pe=w({__name:"IndexView",setup(a){const p=I(),w=t(),{t:L}=x(),q=s(),E=k(""),B=k({type:"photo",ids:[],content:"",password:"",expired_at:null}),G={},R=e=>{const l=e.target;100+l.scrollTop+l.clientHeight>=l.scrollHeight&&(w.isLoading||(w.setPage(w.page+1),w.fetchPhotos()))};function J(e){(e.ctrlKey||e.metaKey)&&"a"===e.key&&(e.preventDefault(),w.selectAll())}const V=[{label:L("Newest"),value:"latest"},{label:L("Oldest"),value:"oldest"}],W=k({q:"",storage_id:null,order_by:"latest"});function Q(){w.resetPhotos({storage_id:W.value.storage_id,q:`sort:${W.value.order_by} ${W.value.q}`})}function X(){if(0===w.selections.length)return void q.warning(L("Please select photos first"));const e={...B.value};if(e.ids=w.selections.map((e=>e.id)),e.expired_at){const l=new Date(e.expired_at);e.expired_at=l.toISOString().slice(0,19).replace("T"," ")}K({body:e}).then((e=>{var l,a,t;if("error"===(null==(l=e.data)?void 0:l.status))return q.error(null==(a=e.data)?void 0:a.message);E.value=`${window.location.origin}/shares/${null==(t=e.data)?void 0:t.data.slug}`})).catch((()=>{q.error(L("Failed to create share"))}))}function Y(){c.copyText(E.value).then((()=>{q.success(L("Copy successful"))})).catch((()=>{q.error(L("Copy failed"))}))}return S((()=>w.shareModalActive),(e=>{e&&(E.value="",B.value={type:"photo",ids:[],content:"",password:"",expired_at:null})})),S(W,v.debounce((()=>Q()),500),{deep:!0}),O((()=>{Q(),window.addEventListener("keydown",J)})),N((()=>{window.removeEventListener("keydown",J)})),(a,t)=>(T(),j(r,{"toggle-header":!1,"show-footer":!1,"header-title":`${$(w).selections.length>0?a.$t("{count} items selected",{count:$(o).format($(w).selections.length)}):a.$t("Photo Management")}`,"on-scroll":R},{default:P((()=>[z(e,{class:"max-w-full bg-white dark:bg-[var(--n-color)]"},{default:P((()=>{var e;return[C("div",oe,[t[7]||(t[7]=C("div",null,null,-1)),C("div",re,[z($(l),{value:W.value.q,"onUpdate:value":t[0]||(t[0]=e=>W.value.q=e),class:"max-w-44",placeholder:a.$t("Enter keywords to search..."),clearable:""},null,8,["value","placeholder"]),z($(i),{class:"max-w-52",filterable:"",clearable:"",placeholder:a.$t("Storage Filter"),value:W.value.storage_id,"onUpdate:value":t[1]||(t[1]=e=>W.value.storage_id=e),options:(null==(e=$(p).group)?void 0:e.storages)||[],"label-field":"name","value-field":"id"},null,8,["placeholder","value","options"]),z($(i),{class:"w-32 shrink-0",placeholder:a.$t("Sort"),options:V,value:W.value.order_by,"onUpdate:value":t[2]||(t[2]=e=>W.value.order_by=e)},null,8,["placeholder","value"])])]),C("div",ie,[C("div",ne,[z(f)]),z(m,null,{default:P((()=>[z(h),z(b),z(y),z(g),z(se),z(te),z(_)])),_:1})])]})),_:1}),z($(A),{show:$(w).shareModalActive,"onUpdate:show":t[6]||(t[6]=e=>$(w).shareModalActive=e),title:a.$t("Share Photos"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto z-50"},{action:P((()=>[E.value?(T(),U("div",ce,[z($(l),{class:"grow select-all","default-value":E.value,readonly:""},null,8,["default-value"]),z($(F),{tertiary:"",type:"primary",class:"shrink-0",onClick:Y},{icon:P((()=>[z($(D),{icon:"fa-solid fa-copy"})])),_:1})])):(T(),U("div",ue,[z($(F),{tertiary:"",onClick:X},{default:P((()=>[H(M(a.$t("Create Share Link")),1)])),_:1})]))])),default:P((()=>[C("div",de,[z($(n),{model:B.value,rules:G,disabled:Boolean(E.value)},{default:P((()=>[z($(d),{label:a.$t("Share Description"),path:"content"},{default:P((()=>[z($(l),{resizable:"",type:"textarea",value:B.value.content,"onUpdate:value":t[3]||(t[3]=e=>B.value.content=e)},null,8,["value"])])),_:1},8,["label"]),z($(d),{label:a.$t("Password"),path:"password"},{default:P((()=>[z($(l),{type:"password",value:B.value.password,"onUpdate:value":t[4]||(t[4]=e=>B.value.password=e)},null,8,["value"])])),_:1},8,["label"]),z($(d),{label:a.$t("Expiration Time"),path:"expired_at"},{default:P((()=>[z($(u),{value:B.value.expired_at,"onUpdate:value":t[5]||(t[5]=e=>B.value.expired_at=e),type:"datetime",class:"w-full",placeholder:a.$t("Select Expiration Time"),"is-date-disabled":e=>e<Date.now(),clearable:""},null,8,["value","placeholder","is-date-disabled"])])),_:1},8,["label"])])),_:1},8,["model","disabled"])])])),_:1},8,["show","title"])])),_:1},8,["header-title"]))}});export{pe as default};
