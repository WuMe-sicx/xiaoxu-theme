import{a as e,_ as a,r as l,g as t,N as s,c as o,d as r}from"./Layout.vue_vue_type_script_setup_true_lang-DggjovG3.js";import{_ as n}from"./Content.vue_vue_type_script_setup_true_lang-BU2yl4QK.js";import{d as u,b as i,e as d,g as c,j as v,k as f,a as p,o as m,aY as _,L as w,c as g,p as x,q as h,aZ as b,A as k,B as y,R as j,E as T,y as C,C as $,G as N,F as S,D as I,a_ as R}from"./index-HMHCBO22.js";import{_ as z}from"./Back.vue_vue_type_script_setup_true_lang-CqzeplWU.js";import{N as D,a as L}from"./CollapseItem-BzPm4vx0.js";import{N as U,a as A}from"./DescriptionsItem-D3Ta2R0i.js";import{N as M}from"./InfiniteScroll-Dgt10tIe.js";import{N as B}from"./Spin-DJBzsfd9.js";const q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},H=[c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)],P=u({name:"ArrowUpOutline",render:function(e,a){return d(),i("svg",q,H)}}),E={class:"flex flex-col space-y-2 h-full"},F={class:"flex-none space-x-2"},G={key:0,class:"flex space-x-2 overflow-hidden mb-5"},O={class:"flex flex-col items-end space-y-1 grow"},V={class:"text-gray-500 text-xs"},Y={class:"flex-none w-fit inline-block bg-[#20b2e5] text-white overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},Z={key:1,class:"flex space-x-2 overflow-hidden mb-5"},J={class:"flex flex-col space-y-1 grow"},K={class:"text-gray-500 text-xs"},Q={class:"flex-none w-fit inline-block bg-gray-200 dark:bg-gray-700 overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},W={class:"shrink-0 w-full mt-5"},X=u({__name:"DetailView",setup(u){const q=w(),H=e(),X=v(),{t:ee}=f(),ae=p({}),le=p(!0),te=p(0),se=p([]),oe=p(!1),re=p(),ne=p("");function ue(){setTimeout((()=>{var e,a,l,t,s;null==(s=null==(e=re.value)?void 0:e.scrollbarInstRef)||s.scrollTo({top:(null==(t=null==(l=null==(a=re.value)?void 0:a.scrollbarInstRef)?void 0:l.contentRef)?void 0:t.scrollHeight)||0,behavior:"smooth"})}),50)}async function ie(){var e,a,l,t;if(!ne.value)return;const s=await R({path:{issue_no:q.params.issue_no.toString()},body:{content:ne.value,is_notify:!0}});if("error"===(null==(e=s.data)?void 0:e.status))return H.error(null==(a=s.data)?void 0:a.message);se.value.push({content:ne.value,created_at:new Date,user:{avatar:null==(l=X.profile)?void 0:l.avatar_url,name:null==(t=X.profile)?void 0:t.name}}),ne.value="",ue()}m((async()=>{var e,a,l;const t=await _({path:{issue_no:q.params.issue_no.toString()}});if("error"===(null==(e=t.data)?void 0:e.status))return H.error(null==(a=t.data)?void 0:a.message);ae.value=(null==(l=t.data)?void 0:l.data)||{},await async function(){var e,a,l;if(oe.value)return;te.value++,le.value=!0;const t=await b({path:{issue_no:q.params.issue_no.toString()},query:{page:1,per_page:9999}});se.value.push(...(null==(e=t.data)?void 0:e.data.data)||[]),le.value=!1,oe.value=(null==(a=t.data)?void 0:a.data.current_page)===(null==(l=t.data)?void 0:l.data.last_page),ue()}()}));const de=g((()=>({low:ee("Low"),medium:ee("Medium"),high:ee("High")}))),ce=g((()=>({in_progress:ee("Processing"),completed:ee("Completed")})));return(e,u)=>(d(),x(a,{"header-title":e.$t("Ticket Details"),"toggle-header":!1,"show-footer":!1},{default:h((()=>[k(n,{class:"mx-auto p-4 md:p-10 space-y-10 h-full"},{default:h((()=>[c("div",E,[c("div",F,[k(z,{to:"/user/tickets"})]),k(y(j),null,{default:h((()=>[k(y(D),{accordion:"","default-expanded-names":"info"},{default:h((()=>[k(y(L),{title:e.$t("Ticket Information"),name:"info"},{default:h((()=>[k(y(U),{size:"small",bordered:""},{default:h((()=>[k(y(A),{label:e.$t("Ticket Number")},{default:h((()=>[T(C(ae.value.issue_no),1)])),_:1},8,["label"]),k(y(A),{label:e.$t("Ticket Title")},{default:h((()=>[T(C(ae.value.title),1)])),_:1},8,["label"]),k(y(A),{label:e.$t("Ticket Level")},{default:h((()=>[T(C(de.value[ae.value.level]),1)])),_:1},8,["label"]),k(y(A),{label:e.$t("Ticket Status")},{default:h((()=>[T(C(ce.value[ae.value.status]),1)])),_:1},8,["label"]),k(y(A),{label:e.$t("Creation Time")},{default:h((()=>[T(C(y(l)(ae.value.created_at).format("L")),1)])),_:1},8,["label"])])),_:1})])),_:1},8,["title"])])),_:1})])),_:1}),k(y(j),{class:"grow w-full overflow-hidden","content-class":"flex flex-col overflow-hidden"},{default:h((()=>[k(y(M),{ref_key:"infiniteScrollRef",ref:re,class:"grow w-full"},{default:h((()=>[le.value?(d(),x(y(B),{key:0,size:"small",class:"w-full my-10"})):$("",!0),(d(!0),i(S,null,N(se.value,(e=>{var a;return d(),i(S,null,[e.user.id==(null==(a=y(X).profile)?void 0:a.id)?(d(),i("div",G,[c("div",O,[c("p",null,[c("span",V,C(y(l)(e.created_at).fromNow()),1),T(" "+C(e.user.name),1)]),c("p",Y,C(e.content),1)]),k(y(o),{class:"shrink-0",round:"",src:y(r).getUserAvatar(e.user.avatar_url)},null,8,["src"])])):(d(),i("div",Z,[k(y(o),{class:"shrink-0",round:"",src:y(r).getUserAvatar(e.user.avatar_url)},null,8,["src"]),c("div",J,[c("p",null,[T(C(e.user.name)+" ",1),c("span",K,C(y(l)(e.created_at).fromNow()),1)]),c("p",Q,C(e.content),1)])]))],64)})),256))])),_:1},512),c("div",W,[k(y(t),{value:ne.value,"onUpdate:value":u[0]||(u[0]=e=>ne.value=e),size:"large",type:"textarea",autosize:{minRows:1,maxRows:4},class:"w-full",placeholder:"completed"===ae.value.status?e.$t("Ticket Completed"):e.$t("Please describe your problem"),disabled:"completed"===ae.value.status},{suffix:h((()=>[k(y(I),{strong:"",secondary:"",circle:"",type:"primary",size:"small",onClick:ie,disabled:"completed"===ae.value.status||""==ne.value},{icon:h((()=>[k(y(s),{size:14,component:y(P)},null,8,["component"])])),_:1},8,["disabled"])])),_:1},8,["value","placeholder","disabled"])])])),_:1})])])),_:1})])),_:1},8,["header-title"]))}});export{X as default};
